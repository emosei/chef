{"name":"mariadb","version":"2.1.0","description":"Installs/Configures MariaDB","long_description":"MariaDB Cookbook\n================\n\n[![Cookbook Version](https://img.shields.io/cookbook/v/mariadb.svg)](https://supermarket.chef.io/cookbooks/mariadb)\n[![Build Status](https://img.shields.io/circleci/project/github/sous-chefs/mariadb/master.svg)](https://circleci.com/gh/sous-chefs/mariadb)\n\n## Description\n\nThis cookbook contains all the stuffs to install and configure and manage a mariadb server on a dpkg/apt compliant system (typically debian), or a rpm/yum compliant system (typically centos)\n\n\n## Requirements\n\n#### repository\n- `mariadb` - This cookbook need that you have a valid apt repository installed with the mariadb official packages\n\n#### packages\n- `percona-xtrabackup` - if you want to use the xtrabckup SST Auth for galera cluster.\n- `mariadb-backup` - if you want to use the mariabackup SST Auth for galera cluster.\n- `socat` - if you want to use the xtrabckup or mariabackup SST Auth for galera cluster.\n- `rsync` - if you want to use the rsync SST Auth for galera cluster.\n- `debconf-utils` - if you use debian platform family.\n\n#### operating system\n- `debian` - this cookbook is fully tested on debian\n- `ubuntu` - this cookbook is fully tested on ubuntu\n- `centos` - this cookbook is fully tested on centos\n\n#### Chef version\nSince version 2.0.0 of this cookbook, chef 13 support is dropped. New chef 14 is the minimum version tested.\nIf you can't upgrade your chef 13, please user the version 1.5.4 or earlier of this cookbook.\n\n## Upgrading\n\nIf you are wondering where all the recipes went in v2.0+, or how on earth I use this new cookbook please see upgrading.md for a full description.\n\n## Resources\n\n### mariadb_repository\n\nIt installs the mariadb.org apt or yum repository\n\n#### Actions\n\n- `install` - (default) Install mariadb.org apt or yum repository\n\n#### Properties\n\nName                | Types             | Description                                                   | Default                                   | Required?\n------------------- | ----------------- | ------------------------------------------------------------- | ----------------------------------------- | ---------\n`version`           | String            | Version of MariaDB to install                                 | '10.3'                                    | no\n\n#### Examples\n\nTo install '10.3' version:\n\n```ruby\nmariadb_repository 'MariaDB 10.3 Repository' do\n  version '10.3'\nend\n```\n\n### mariadb_client_install\n\nThis resource installs mariadb client packages.\n\n#### Actions\n\n- `install` - (default) Install client packages\n\n#### Properties\n\nName                | Types             | Description                                                   | Default                                   | Required?\n------------------- | ----------------- | ------------------------------------------------------------- | ----------------------------------------- | ---------\n`version`           | String            | Version of MariaDB to install                                 | '10.3'                                    | no\n`setup_repo`        | Boolean           | Define if you want to add the MariaDB repository              | true                                      | no\n\n#### Examples\n\nTo install '10.3' version:\n\n```ruby\nmariadb_client_install 'MariaDB Client install' do\n  version '10.3'\nend\n```\n\n### mariadb_server_install\n\nThis resource installs mariadb server packages.\n\n#### Actions\n\n- `install` - (default) Install server packages\n- `create`  - Start the service, change the user root password\n\n#### Properties\n\nName                            | Types             | Description                                                   | Default                                   | Required?\n------------------------------- | ----------------- | ------------------------------------------------------------- | ----------------------------------------- | ---------\n`version`                       | String            | Version of MariaDB to install                                 | '10.3'                                    | no\n`setup_repo`                    | Boolean           | Define if you want to add the MariaDB repository              | true                                      | no\n`mycnf_file`                    | String            |                                                               | \"#{conf_dir}/my.cnf\"                      | no\n`extra_configuration_directory` | String            |                                                               | ext_conf_dir                              | no\n`external_pid_file`             | String            |                                                               | default_pid_file                          | no\n`cookbook`                      | String            | The cookbook to look in for the template source               | 'mariadb'                                 | yes\n`password`                      | String, nil       | Pass in a password, or have the cookbook generate one for you | 'generate'                                | no\n`port`                          | String, Integer   | Database listen port                                          | 3306                                      | no\n\n#### Examples\n\nTo install '10.3' version:\n\n```ruby\nmariadb_server_install 'MariaDB Server install' do\n  version '10.3'\nend\n```\n\n### mariadb_configuration\n\nMainly use for internal purpose. You can use it to create a new configuration file into configuration dir. You have to define 2 variables `section` and `option`.\nWhere `section` is the configuration section, and `option` is a hash of key/value. The name of the resource is used as base for the filename.\n\n#### Actions\n\n- `add` - (default) Install the extra configuration file\n- `remove`  - Remove the extra configuration file\n\n#### Properties\n\nName                | Types             | Description                                                   | Default                                   | Required?\n------------------- | ----------------- | ------------------------------------------------------------- | ----------------------------------------- | ---------\n`configuration_name`| String            | Name of the extra conf file, used for .cnf filename           |                                           | yes\n`section`           | String            |                                                               |                                           | yes\n`option`            | Hash              | All option to write in the configuration file                 | {}                                        | yes\n`cookbook`          | String            | The cookbook to look in for the template source               | 'mariadb'                                 | yes\n`extconf_directory` | String            | An additional directory from which Mysql read extra cnf       | \"ext_conf_dir                             | yes\n\n#### Examples\n\nThis example:\n```ruby\nmariadb_configuration 'fake' do\n  section 'mysqld'\n  option :foo => 'bar'\nend\n```\nwill become the file fake.cnf in the include dir (depend on your platform), which contain:\n```\n[mysqld]\nfoo=bar\n```\n\nIn another example, if the value start with a '#', then it's considered as a comment, and the value is printed as is (without the key):\n```ruby\nmariadb_configuration 'fake' do\n  section 'mysqld'\n  option :comment1 => '# Here i am',\n    :foo => bar\nend\n```\nwill become the file fake.cnf in the include dir (depend on your platform), which contain:\n```\n[mysqld]\n# Here i am\nfoo=bar\n```\n### mariadb_server_configuration\n\n#### Actions\n\n- `modify` - (default) Maintain the configuration file\n\n#### Properties\n\nName                            | Types             | Description                                                   | Default                                    | Required?\n------------------------------- | ----------------- | ------------------------------------------------------------- | ------------------------------------------ | ---------\n`version`                       | String            | Version of MariaDB installed                                  | '10.3'                                     | no\n`cookbook`                      | String            |                                                               | 'mariadb'                                  | no\n`mycnf_file`                    | String            |                                                               | \"#{conf_dir}my.cnf\"                        | no\n`extra_configuration_directory` | String,           |                                                               | ext_conf_dir                               | no\n`client_port`                   | String, Integer   |                                                               | 3306                                       | no\n`client_socket`                 | String            |                                                               | default_socket                             | no\n`client_host`                   | String, nil       |                                                               | nil                                        | no\n`client_options`                | Hash              |                                                               | {}                                         | no\n`mysqld_safe_socket`            | String            |                                                               | default_socket                             | no\n`mysqld_safe_nice`              | String, Integer   |                                                               | 0                                          | no\n`mysqld_safe_options`           | Hash              |                                                               | {}                                         | no\n`mysqld_user`                   | String            |                                                               | 'mysql'                                    | no\n`mysqld_pid_file`               | String, nil       |                                                               | default_pid_file                           | no\n`mysqld_socket`                 | String            |                                                               | default_socket                             | no\n`mysqld_basedir`                | String            |                                                               | '/usr'                                     | no\n`mysqld_datadir`                | String            |                                                               | '/var/lib/mysql'                           | no\n`mysqld_tmpdir`                 | String            |                                                               | '/var/tmp'                                 | no\n`mysqld_lc_messages_dir`        | String            |                                                               | '/usr/share/mysql'                         | no\n`mysqld_lc_messages`            | String            |                                                               | 'en_US'                                    | no\n`mysqld_skip_external_locking`  | Boolean           |                                                               | true                                       | no\n`mysqld_skip_log_bin`           | Boolean           |                                                               | false                                      | no\n`mysqld_skip_name_resolve`      | Boolean           |                                                               | false                                      | no\n`mysqld_bind_address`           | String            |                                                               | '127.0.0.1'                                | no\n`mysqld_max_connections`        | Integer           |                                                               | 100                                        | no\n`mysqld_max_statement_time`     | Integer, nil      |                                                               | nil                                        | no\n`mysqld_connect_timeout`        | Integer           |                                                               | 5                                          | no\n`mysqld_wait_timeout`           | Integer           |                                                               | 600                                        | no\n`mysqld_max_allowed_packet`     | String            |                                                               | '16M'                                      | no\n`mysqld_thread_cache_sizer`     | Integer           |                                                               | 128                                        | no\n`mysqld_sort_buffer_size`       | String            |                                                               | '4M'                                       | no\n`mysqld_bulk_insert_buffer_size`| String            |                                                               | '16M'                                      | no\n`mysqld_tmp_table_size`         | String            |                                                               | '32M'                                      | no\n`mysqld_max_heap_table_size`    | String            |                                                               | '32M'                                      | no\n`mysqld_myisam_recover`         | String            |                                                               | 'BACKUP'                                   | no\n`mysqld_key_buffer_size`        | String            |                                                               | '128M'                                     | no\n`mysqld_open_files_limit`       | Integer, nil      |                                                               | nil                                        | no\n`mysqld_table_open_cache`       | Integer           |                                                               | 400                                        | no\n`mysqld_myisam_sort_buffer_size`| String            |                                                               | '512M'                                     | no\n`mysqld_concurrent_insert`      | Integer           |                                                               | 2                                          | no\n`mysqld_read_buffer_size`       | String            |                                                               | '2M'                                       | no\n`mysqld_read_rnd_buffer_size`   | String            |                                                               | '1M'                                       | no\n`mysqld_query_cache_limit`      | String            |                                                               | '128K'                                     | no\n`mysqld_query_cache_size`       | String            |                                                               | '64M'                                      | no\n`mysqld_query_cache_type`       | String, nil       |                                                               | nil                                        | no\n`mysqld_default_storage_engine` | String            |                                                               | 'InnoDB'                                   | no\n`mysqld_log_directory`          | String            |                                                               | '/var/log/mysql'                           | no\n`mysqld_general_log_file`       | String            |                                                               | \"#{mysqld_log_directory}/mysql.log\"        | no\n`mysqld_general_log`            | Integer           |                                                               | 0                                          | no\n`mysqld_log_warnings`           | Integer           |                                                               | 2                                          | no\n`mysqld_slow_query_log`         | Integer           |                                                               | 0                                          | no\n`mysqld_slow_query_log_file`    | String            |                                                               | \"#{mysqld_log_directory}/mariadb-slow.log\" | no\n`mysqld_long_query_time`        | Integer           |                                                               | 10                                         | no\n`mysqld_log_slow_rate_limit`    | Integer           |                                                               | 1000                                       | no\n`mysqld_log_slow_verbosity`     | String            |                                                               | 'query_plan'                               | no\n`mysqld_log_output`             | String            |                                                               | 'FILE'                                     | no\n`mysqld_options`                | Hash              |                                                               | {}                                         | no\n`mysqldump_quick`               | Boolean           |                                                               | true                                       | no\n`mysqldump_quote_names`         | Boolean           |                                                               | true                                       | no\n`mysqldump_max_allowed_packet`  | String            |                                                               | '16M'                                      | no\n`mysqldump_options`             | Hash              |                                                               | {}                                         | no\n`isamchk_key_buffer`            | String            |                                                               | '16M'                                      | no\n`isamchk_options`               | Hash              |                                                               | {}                                         | no\n`innodb_log_file_size`          | String            |                                                               | '50M'                                      | no\n`innodb_bps_percentage_memory`  | Boolean           |                                                               | false                                      | no\n`innodb_buffer_pool_size`       | String            |                                                               | '50M'                                      | no\n`innodb_log_buffer_size`        | String            |                                                               | '8M'                                       | no\n`innodb_file_per_table`         | Integer           |                                                               | 1                                          | no\n`innodb_open_files`             | Integer           |                                                               | 400                                        | no\n`innodb_io_capacity`            | Integer           |                                                               | 400                                        | no\n`innodb_flush_method`           | String            |                                                               | 'O_DIRECT'                                 | no\n`innodb_options`                | Hash              |                                                               | {}                                         | no\n`replication_server_id`         | String, nil       |                                                               | nil                                        | no\n`replication_log_bin`           | String            |                                                               | \"#{mysqld_log_directory}/mariadb-bin'      | no\n`replication_log_bin_index`     | String            |                                                               | \"#{mysqld_log_directory}/mariadb-bin.index'| no\n`replication_sync_binlog`       | String, Integer   |                                                               | 0                                          | no\n`replication_expire_logs_days`  | Integer           |                                                               | 10                                         | no\n`replication_max_binlog_size`   | String            |                                                               | '100M'                                     | no\n`replication_options`           | Hash              |                                                               | {}                                         | no\n\n#### Examples\n\n```ruby\nmariadb_server_configuration 'MariaDB Server Configuration' do\n  version '10.3'\n  client_host 'localhost'\nend\n```\n\n### mariadb_galera_configuration\n\nDo all configuration to have a working Galera Cluster\n\n#### Actions\n\n- `create` - (default) Create & Maintain the configuration file\n- `remove` - Remove the galera configuration file\n\n#### Properties\n\nName                                   | Types             | Description                                                   | Default                                   | Required?\n---------------------------------------| ----------------- | ------------------------------------------------------------- | ----------------------------------------- | ---------\n`version`                              | String            | Version of MariaDB installed                                  | '10.3'                                    | no\n`cookbook`                             | String            |                                                               | 'mariadb'                                 | no\n`extra_configuration_directory`        | String            |                                                               | ext_conf_dir                              | no\n`cluster_name`                         | String            |                                                               | 'galera_cluster'                          | no\n`cluster_search_query`                 | String, NilClass  |                                                               | nil                                       | no\n`gcomm_address`                        | String            |                                                               | nil                                       | no\n`server_id`                            | Integer           |                                                               | 100                                       | no\n`wsrep_sst_method`                     | String            | Can be 'rsync', 'xtrabackup' or 'mariabackup'                 | 'rsync'                                   | no\n`wsrep_sst_auth`                       | String            |                                                               | 'sstuser:some_secret_password'            | no\n`wsrep_provider`                       | String            |                                                               | '/usr/lib/galera/libgalera_smm.so'        | no\n`wsrep_slave_threads`                  | String            | By default the MariaDB recommended value is set (nb_cpu * 4)  | '%{auto}'                                 | no\n`innodb_flush_log_at_trx_commit`       | Integer           |                                                               | 2                                         | no\n`wsrep_node_address_interface`         | String, NilClass  |                                                               | nil                                       | no\n`wsrep_node_port`                      | Integer, NilClass |                                                               | nil                                       | no\n`wsrep_node_incoming_address_interface`| String, NilClass  |                                                               | nil                                       | no\n`wsrep_provider_options`               | Hash              |                                                               | {'gcache.size': '512M'}                   | no\n`options`                              | Hash              |                                                               | {}                                        | no\n`cluster_nodes`                        ï Array             |                                                               | []                                        | no\n\n#### Examples\n\nIf you use a chef-server, set an attribute within your cookbook to determine which nodes belong to the cluster. If your cookbook is 'mycookbook' set:\n\n```ruby\ndefault['mycookbook']['galera']['cluster_name'] = 'my_functionnal_cluster_name'\n```\n\nThen all nodes to add to gcomm will be choosen with a search based on this attribute:\n\n```ruby\nmariadb_galera_configuration 'MariaDB Galera Server Configuration' do\n  version '10.3'\n  cluster_name 'my_functionnal_cluster_name'\n  cluster_search_query \"mycookbook_galera_cluster_name:my_functionnal_cluster_name\"\nend\n```\n\nIf you don't want to have a dynamic node galera node management, set manually the gcomm_address with all nodes you want in it:\n\n```ruby\nmariadb_galera_configuration 'MariaDB Galera Server Configuration' do\n  version '10.3'\n  cluster_name 'my_functionnal_cluster_name'\n  gcomm_address 'gcomm://node1.fqdn,node2.fqdn'\nend\n```\n\n### mariadb_replication\n\nIt's used to manage replication setup on a host. To use it, the node need to have the mysql binary installed (via the mariadb_server_install or mariadb_client_install resource).\n\n#### Actions\n\n- add - to add a new replication setup (become a slave)\n- stop - to stop the slave replication\n- start - to start the slave replication\n- remove - to remove the slave replication configuration\n\n#### Properties\n\nThe resource name need to be 'default' if your don't want to use a named connection (multi source replication in MariaDB 10).\n\nName                                   | Types             | Description                                                   | Default                                   | Required?\n---------------------------------------| ----------------- | ------------------------------------------------------------- | ----------------------------------------- | ---------\n`version`                              | String            | Version of MariaDB installed                                  | '10.3'                                    | no\n`cookbook`                             | String            |                                                               | 'mariadb'                                 | no\n`connection_name`                      | String            | The resource name                                             |                                           | yes\n`host`                                 | String, nil       |                                                               | 'localhost'                               | no\n`port`                                 | Integer, nil      |                                                               | 3306                                      | no \n`user`                                 | String, nil       |                                                               | 'root'                                    | no \n`password`                             | String, nil       |                                                               | nil                                       | no \n`change_master_while_running`          | true, false       |                                                               | false                                     | no \n`master_password`                      | String            |                                                               |                                           | yes \n`master_port`                          | Integer           |                                                               | 3306                                      | no \n`master_use_gtid`                      | String            |                                                               | 'No'                                      | no \n`master_host`                          | String            |                                                               |                                           | yes\n`master_user`                          | String            |                                                               |                                           | yes\n`master_connect_retry`                 | String            |                                                               |                                           | no\n`master_log_pos`                       | Integer           |                                                               |                                           | no\n`master_log_file`                      | String            |                                                               |                                           | no\n\n#### Examples\n\n```ruby\nmariadb_replication 'default' do\n  user 'root'\n  password 'fakepass'\n  host 'fakehost'\n  action :stop\nend\n```\nwill stop the replication on the host `fakehost` using the user `root` and password `fakepass` to connect to.\n\nWhen you add a replication configuration, you have to define at least 4 values `master_host`, `master_user`, `master_password` and `master_use_gtid`. And if you don't want the GTID support, you have to define also `master_log_file` and `master_log_pos`\n\n```ruby\nmariadb_replication 'usefull_conn_name' do\n  master_host 'server1'\n  master_user 'slave_user'\n  master_password 'slave_password'\n  master_use_gtid 'current_pos'\n  action :add\nend\n```\n\nBy default, resource doesn't change master if slave is running. If you want to let resource change slave settings for replication channel while slave is running use `change_master_while_running` property. When it's set to `true` slave settings will be changed\nif either one of `master_host`, `master_port`, `master_user`, `master_password` and `master_use_gtid` was changed.\n\nChanges of only `master_log_file` and/or `master_log_pos` don't affect server if slave is already configured.\n\n#### mariadb_database\n\nManage databases and execute SQL queries on them. It works by establishing a control connection to the MariaDB server using the `mysql2` chef gem (automatically installed). It has 3 actions:\n- create - to create a named database\n- drop - to drop a named database\n- query - to execute a SQL query\n\n##### Syntax\n\nThe full syntax of all of the properties that are available to the `mariadb_database` resource is: \n\n```ruby\nmariadb_database 'name' do\n  # Credentials for the control connection\n  user                       String # defaults to 'root'\n  host                       String # defaults to 'localhost'\n  port                       String # defaults to node['mariadb']['mysqld']['port']\n  password                   String # defaults to node['mariadb']['server_root_password'] \n  # The database to be managed\n  database_name              String # defaults to 'name' if not specified\n  encoding                   String # defaults to 'utf8'\n  collation                  String # defaults to 'utf8_general_ci'\n  sql                        String, Proc # the SQL query to execute \n  action                     Symbol # defaults to :create if not specified\nend\n```\n\nWhen `host` has the value `localhost`, it will try to connect using the Unix socket defined in `node['mariadb']['client']['socket']`, or TCP/IP if no socket is defined.\n\n##### Examples\n\n```ruby\n# Create a database\nmariadb_database 'wordpress-cust01' do\n  host '127.0.0.1'\n  user 'root'\n  password node['wordpress-cust01']['mysql']['initial_root_password']\n  action :create\nend\n \n# Drop a database\nmariadb_database 'baz' do\n  action :drop\nend\n \n# Query a database\nmariadb_database 'flush the privileges' do\n  sql 'flush privileges'\n  action :query\nend\n```\n\nThe `query` action will NOT select a database before running the query, nor return the actual results from the SQL query.\n\n#### mariadb_user\n\nManage users and grant them privileges on database objects. It works by establishing a control connection to the MariaDB server using the `mysql2` chef gem (automatically installed). It has 4 actions:\n- create - to create a user\n- drop - to drop a user\n- grant - to grant privileges to a user\n- revoke - to revoke privileges from a user\n\n##### Syntax\n\nThe full syntax of all of the properties that are available to the `mariadb_user` resource is: \n\n```ruby\nmariadb_user 'name' do\n  # Credentials for the control connection\n  ctrl_user                  String # defaults to 'root'\n  ctrl_host                  String # defaults to 'localhost'\n  ctrl_port                  String # defaults to node['mariadb']['mysqld']['port']\n  ctrl_password              String # defaults to node['mariadb']['server_root_password'] \n  # The user to be managed\n  username                   String # defaults to 'name'\n  host                       String # defaults to 'localhost'\n  password                   String, HashedPassword\n  # The privileges to be granted/revoked\n  privileges                 Array # defaults to [:all]\n  database_name              String # to grant/revoke privileges on a database \n  table                      String # to grant/revoke privileges on a particular database table\n  grant_option               true|false # defaults to false \n  require_ssl                true|false # defaults to false\n  require_x509               true|false # defaults to false \n  action                     Symbol # defaults to :create if not specified\nend\n```\n\n##### Examples\n\n```ruby\n# Create an user but grant no privileges\nmariadb_user 'disenfranchised' do\n  password 'super_secret'\n  action :create\nend\n \n# Create an user using a hashed password string instead of plain text one\nmariadb_user 'disenfranchised' do\n  password hashed_password('md5eacdbf8d9847a76978bd515fae200a2a')\n  action :create\nend\n\n# Drop a user\nmariadb_user 'foo_user' do\n  action :drop\nend\n\n# Grant SELECT, UPDATE, and INSERT privileges to all tables in foo db from all hosts\nmariadb_user 'foo_user' do\n  password 'super_secret'\n  database_name 'foo'\n  host '%'\n  privileges [:select,:update,:insert]\n  action :grant\nend\n```\n\nContributing\n------------\n\n1. Fork the repository on Github\n2. Create a named feature branch (like `add_component_x`)\n3. Write your change\n4. Write tests for your change (if applicable)\n5. Run the tests, ensuring they all pass\n6. Submit a Pull Request using Github\n\nLicense and Authors\n-------------------\nAuthors:\nNicolas Blanc <sinfomicien@gmail.com>\n","maintainer":"Sous Chefs","maintainer_email":"help@sous-chefs.org","license":"Apache-2.0","platforms":{"ubuntu":">= 0.0.0","debian":">= 8.0","centos":">= 6.4"},"dependencies":{"selinux_policy":"~> 2.0"},"recommendations":{},"suggestions":{},"conflicting":{},"providing":{},"replacing":{},"attributes":{},"groupings":{},"recipes":{},"source_url":"https://github.com/sous-chefs/mariadb","issues_url":"https://github.com/sous-chefs/mariadb/issues","chef_version":[[">= 13"]],"ohai_version":[]}